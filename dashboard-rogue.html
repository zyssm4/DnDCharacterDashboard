<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schurken Dashboard - Pirat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0f0a 0%, #2d1810 100%);
            background-image:
                linear-gradient(135deg, rgba(200, 16, 46, 0.1) 0%, rgba(26, 15, 10, 0.9) 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="60" opacity="0.05">üè¥‚Äç‚ò†Ô∏è</text></svg>');
            color: #ffe8d6;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(200, 16, 46, 0.9);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid #e6b800;
        }

        .navbar h1 {
            color: #e6b800;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .nav-menu {
            display: flex;
            gap: 20px;
        }

        .nav-item {
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            border: 2px solid #e6b800;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: #ffe8d6;
        }

        .nav-item:hover {
            background: rgba(230, 184, 0, 0.3);
            border-color: #ffd700;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: rgba(45, 24, 16, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #c8102e;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .card h2 {
            color: #e6b800;
            margin-bottom: 15px;
            font-size: 1.3em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .stat-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.4);
            border-radius: 5px;
            margin-bottom: 8px;
            border: 1px solid #c8102e;
        }

        .stat-compact.proficient {
            background: rgba(200, 16, 46, 0.3);
            border-color: #e6b800;
        }

        .stat-compact.expertise {
            background: rgba(230, 184, 0, 0.2);
            border-color: #ffd700;
            border-width: 2px;
        }

        .stat-name {
            font-weight: bold;
            color: #e6b800;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #ffe8d6;
        }

        .ability-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .ability-box {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #c8102e;
        }

        .ability-box .label {
            font-size: 0.8em;
            color: #e6b800;
            margin-bottom: 5px;
        }

        .ability-box .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .ability-box .modifier {
            font-size: 1.1em;
            color: #ffd700;
        }

        .hp-tracker {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            border: 2px solid #c8102e;
        }

        .hp-display {
            font-size: 3em;
            font-weight: bold;
            color: #c8102e;
        }

        .hp-max {
            font-size: 1.2em;
            color: #ffd700;
            margin-top: 5px;
        }

        .hp-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            background: #c8102e;
            color: #ffe8d6;
            border: 2px solid #e6b800;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: bold;
        }

        .btn:hover {
            background: #e6152e;
            border-color: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(200, 16, 46, 0.4);
        }

        .btn-small {
            padding: 5px 15px;
            font-size: 0.9em;
        }

        .btn-danger {
            background: #8b0000;
            border-color: #c8102e;
        }

        .btn-danger:hover {
            background: #a00000;
        }

        .btn-secondary {
            background: rgba(230, 184, 0, 0.8);
            color: #1a0f0a;
        }

        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.9);
        }

        /* Sneak Attack Tracker */
        .sneak-attack-box {
            background: linear-gradient(135deg, rgba(200, 16, 46, 0.3), rgba(139, 0, 0, 0.3));
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #e6b800;
            margin-bottom: 15px;
            text-align: center;
        }

        .sneak-attack-box h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .sneak-damage {
            font-size: 2.5em;
            font-weight: bold;
            color: #c8102e;
            text-shadow: 0 0 10px rgba(200, 16, 46, 0.8);
        }

        .sneak-info {
            margin-top: 10px;
            font-size: 0.9em;
            color: #ffd700;
        }

        /* Cunning Action Box */
        .cunning-action-box {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e6b800;
            margin-bottom: 15px;
        }

        .cunning-action-box h3 {
            color: #e6b800;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .action-item {
            background: rgba(200, 16, 46, 0.2);
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
            border-left: 3px solid #c8102e;
        }

        /* Pirate Equipment */
        .equipment-compact {
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border: 1px solid #e6b800;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .equipment-compact.equipped {
            background: rgba(200, 16, 46, 0.3);
            border-color: #ffd700;
            border-width: 2px;
        }

        .equipment-name {
            font-weight: bold;
            color: #ffd700;
        }

        .equipment-damage {
            color: #c8102e;
            font-weight: bold;
        }

        /* Expertise Badge */
        .expertise-badge {
            display: inline-block;
            background: #ffd700;
            color: #1a0f0a;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            margin-left: 5px;
        }

        /* Feature list */
        .feature-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .feature-item {
            background: rgba(0,0,0,0.4);
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 3px solid #e6b800;
        }

        .feature-item h4 {
            color: #ffd700;
            margin-bottom: 5px;
        }

        .feature-item p {
            font-size: 0.9em;
            color: #ffe8d6;
            line-height: 1.4;
        }

        /* Rest buttons */
        .rest-section {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .rest-section .btn {
            flex: 1;
        }

        /* Pirate flavor elements */
        .pirate-flag {
            font-size: 3em;
            text-align: center;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(230, 184, 0, 0.5));
        }

        /* Weapon attack display */
        .weapon-attack {
            background: rgba(200, 16, 46, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 3px solid #c8102e;
        }

        .weapon-attack-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .weapon-attack-name {
            font-weight: bold;
            color: #e6b800;
        }

        .weapon-attack-bonus {
            font-weight: bold;
            color: #ffd700;
            font-size: 1.1em;
        }

        .weapon-attack-damage {
            color: #c8102e;
            font-size: 0.9em;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c8102e;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #e6152e;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>üè¥‚Äç‚ò†Ô∏è <span id="characterName">Schurke</span> - Stufe <span id="characterLevel">1</span></h1>
        <div class="nav-menu">
            <a href="class-selection.html" class="nav-item">üé≤ Klassenauswahl</a>
            <a href="#" class="nav-item" onclick="showEquipmentTab()">‚öîÔ∏è Ausr√ºstung</a>
            <a href="#" class="nav-item" onclick="showNotesTab()">üìú Notizen</a>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-grid">
            <!-- Left Column: Character Stats -->
            <div class="left-column">
                <div class="card">
                    <div class="pirate-flag">üè¥‚Äç‚ò†Ô∏è</div>
                    <h2>Attribute</h2>
                    <div class="ability-grid">
                        <div class="ability-box">
                            <div class="label">STR</div>
                            <div class="value" id="strValue">10</div>
                            <div class="modifier" id="strMod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="label">DEX</div>
                            <div class="value" id="dexValue">10</div>
                            <div class="modifier" id="dexMod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="label">CON</div>
                            <div class="value" id="conValue">10</div>
                            <div class="modifier" id="conMod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="label">INT</div>
                            <div class="value" id="intValue">10</div>
                            <div class="modifier" id="intMod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="label">WIS</div>
                            <div class="value" id="wisValue">10</div>
                            <div class="modifier" id="wisMod">+0</div>
                        </div>
                        <div class="ability-box">
                            <div class="label">CHA</div>
                            <div class="value" id="chaValue">10</div>
                            <div class="modifier" id="chaMod">+0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Kampfwerte</h2>
                    <div class="stat-compact">
                        <span class="stat-name">R√ºstungsklasse</span>
                        <span class="stat-value" id="armorClass">10</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">Initiative</span>
                        <span class="stat-value" id="initiative">+0</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">Geschwindigkeit</span>
                        <span class="stat-value" id="speed">9m</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">√úbungsbonus</span>
                        <span class="stat-value" id="profBonus">+2</span>
                    </div>
                </div>

                <div class="card">
                    <h2>Rettungsw√ºrfe</h2>
                    <div class="stat-compact proficient">
                        <span class="stat-name">Geschicklichkeit</span>
                        <span class="stat-value" id="saveDex">+0</span>
                    </div>
                    <div class="stat-compact proficient">
                        <span class="stat-name">Intelligenz</span>
                        <span class="stat-value" id="saveInt">+0</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">St√§rke</span>
                        <span class="stat-value" id="saveStr">+0</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">Konstitution</span>
                        <span class="stat-value" id="saveCon">+0</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">Weisheit</span>
                        <span class="stat-value" id="saveWis">+0</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-name">Charisma</span>
                        <span class="stat-value" id="saveCha">+0</span>
                    </div>
                </div>
            </div>

            <!-- Middle Column: Combat & Features -->
            <div class="middle-column">
                <div class="card">
                    <h2>Trefferpunkte</h2>
                    <div class="hp-tracker">
                        <div class="hp-display" id="currentHP">8</div>
                        <div class="hp-max">/ <span id="maxHP">8</span> TP</div>
                        <div class="hp-controls">
                            <button class="btn btn-small" onclick="adjustHP(1)">+1</button>
                            <button class="btn btn-small" onclick="adjustHP(5)">+5</button>
                            <button class="btn btn-small btn-danger" onclick="adjustHP(-1)">-1</button>
                            <button class="btn btn-small btn-danger" onclick="adjustHP(-5)">-5</button>
                        </div>
                    </div>

                    <div class="rest-section">
                        <button class="btn" onclick="shortRest()">Kurze Rast</button>
                        <button class="btn btn-secondary" onclick="longRest()">Lange Rast</button>
                    </div>
                </div>

                <!-- Sneak Attack Box -->
                <div class="card">
                    <div class="sneak-attack-box">
                        <h3>‚öîÔ∏è Hinterh√§ltiger Angriff</h3>
                        <div class="sneak-damage" id="sneakDamage">+1d6</div>
                        <div class="sneak-info">Einmal pro Zug mit Vorteil oder Verb√ºndetem</div>
                    </div>

                    <div class="cunning-action-box" id="cunningActionBox" style="display: none;">
                        <h3>Gewitzte Aktion (Bonusaktion)</h3>
                        <div class="action-item">üèÉ Spurt (Dash)</div>
                        <div class="action-item">ü§∏ L√∂sen (Disengage)</div>
                        <div class="action-item">ü´• Verstecken (Hide)</div>
                    </div>
                </div>

                <!-- Weapons & Attacks -->
                <div class="card">
                    <h2>‚öîÔ∏è Waffen & Angriffe</h2>
                    <div id="weaponsList">
                        <!-- Weapons will be loaded here -->
                    </div>
                </div>

                <!-- Class Features -->
                <div class="card">
                    <h2>Klassenf√§higkeiten</h2>
                    <div class="feature-list" id="featuresList">
                        <!-- Features will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Right Column: Skills & Expertise -->
            <div class="right-column">
                <div class="card">
                    <h2>Fertigkeiten</h2>
                    <div id="skillsList">
                        <!-- Skills will be loaded here -->
                    </div>
                </div>

                <div class="card">
                    <h2>Ausr√ºstung</h2>
                    <div id="equipmentList">
                        <!-- Equipment will be loaded here -->
                    </div>
                    <button class="btn" style="width: 100%; margin-top: 10px;" onclick="showEquipmentBrowser()">
                        üì¶ Ausr√ºstung durchsuchen
                    </button>
                </div>

                <div class="card">
                    <h2>Hintergrund: <span id="backgroundName">Pirat</span></h2>
                    <div class="feature-item">
                        <h4 id="backgroundFeatureName">Schlechter Ruf</h4>
                        <p id="backgroundFeatureDesc">Die Leute f√ºrchten dich aufgrund deines Rufs als Pirat.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'db_actions.php';
        let characterStats = {};
        let characterId = 1; // Will be loaded from DB

        // Skills with ability mapping
        const skills = {
            'acrobatics': { name: 'Akrobatik', ability: 'dex' },
            'animal_handling': { name: 'Tierf√ºhrung', ability: 'wis' },
            'arcana': { name: 'Arkane Kunde', ability: 'int' },
            'athletics': { name: 'Athletik', ability: 'str' },
            'deception': { name: 'T√§uschung', ability: 'cha' },
            'history': { name: 'Geschichte', ability: 'int' },
            'insight': { name: 'Motiv erkennen', ability: 'wis' },
            'intimidation': { name: 'Einsch√ºchtern', ability: 'cha' },
            'investigation': { name: 'Nachforschung', ability: 'int' },
            'medicine': { name: 'Heilkunde', ability: 'wis' },
            'nature': { name: 'Naturkunde', ability: 'int' },
            'perception': { name: 'Wahrnehmung', ability: 'wis' },
            'performance': { name: 'Auftreten', ability: 'cha' },
            'persuasion': { name: '√úberzeugen', ability: 'cha' },
            'religion': { name: 'Religion', ability: 'int' },
            'sleight_of_hand': { name: 'Fingerfertigkeit', ability: 'dex' },
            'stealth': { name: 'Heimlichkeit', ability: 'dex' },
            'survival': { name: '√úberlebenskunst', ability: 'wis' }
        };

        // Sneak Attack damage by level
        const sneakAttackDice = {
            1: '1d6', 2: '1d6', 3: '2d6', 4: '2d6', 5: '3d6', 6: '3d6',
            7: '4d6', 8: '4d6', 9: '5d6', 10: '5d6', 11: '6d6', 12: '6d6',
            13: '7d6', 14: '7d6', 15: '8d6', 16: '8d6', 17: '9d6', 18: '9d6',
            19: '10d6', 20: '10d6'
        };

        async function loadCharacter() {
            try {
                const response = await fetch(`${API_URL}?action=character&class=rogue`);
                const result = await response.json();

                if (result.success && result.data) {
                    const char = result.data;
                    characterStats = char;
                    characterId = char.id;

                    // Update basic info
                    document.getElementById('characterName').textContent = char.name;
                    document.getElementById('characterLevel').textContent = char.level;

                    // Update abilities
                    updateAbilities(char);

                    // Update combat stats
                    document.getElementById('armorClass').textContent = char.armor_class || 10;
                    document.getElementById('speed').textContent = '9m';
                    document.getElementById('profBonus').textContent = '+' + getProficiencyBonus(char.level);

                    // Update HP
                    document.getElementById('currentHP').textContent = char.current_hp;
                    document.getElementById('maxHP').textContent = char.max_hp;

                    // Update sneak attack
                    document.getElementById('sneakDamage').textContent = '+' + sneakAttackDice[char.level];

                    // Show Cunning Action if level 2+
                    if (char.level >= 2) {
                        document.getElementById('cunningActionBox').style.display = 'block';
                    }

                    // Load skills, features, equipment
                    loadSkills(char);
                    loadFeatures(char);
                    loadEquipment(char);
                    loadWeapons(char);
                } else {
                    console.error('Kein Charakter gefunden');
                }
            } catch (error) {
                console.error('Fehler beim Laden des Charakters:', error);
            }
        }

        function updateAbilities(char) {
            const abilities = {
                str: char.strength,
                dex: char.dexterity,
                con: char.constitution,
                int: char.intelligence,
                wis: char.wisdom,
                cha: char.charisma
            };

            Object.entries(abilities).forEach(([key, value]) => {
                document.getElementById(`${key}Value`).textContent = value;
                const modifier = Math.floor((value - 10) / 2);
                const modText = modifier >= 0 ? `+${modifier}` : `${modifier}`;
                document.getElementById(`${key}Mod`).textContent = modText;
            });

            // Update saves (Rogue has DEX and INT proficiency)
            const profBonus = getProficiencyBonus(char.level);
            const saveProficiencies = ['dex', 'int'];

            Object.entries(abilities).forEach(([key, value]) => {
                const modifier = Math.floor((value - 10) / 2);
                const isProficient = saveProficiencies.includes(key);
                const saveBonus = modifier + (isProficient ? profBonus : 0);
                const saveText = saveBonus >= 0 ? `+${saveBonus}` : `${saveBonus}`;
                const saveId = `save${key.charAt(0).toUpperCase() + key.slice(1)}`;
                if (document.getElementById(saveId)) {
                    document.getElementById(saveId).textContent = saveText;
                }
            });

            // Update initiative
            const dexMod = Math.floor((char.dexterity - 10) / 2);
            document.getElementById('initiative').textContent = dexMod >= 0 ? `+${dexMod}` : `${dexMod}`;
        }

        function loadSkills(char) {
            const skillsList = document.getElementById('skillsList');
            skillsList.innerHTML = '';

            const profBonus = getProficiencyBonus(char.level);
            const proficientSkills = JSON.parse(char.proficient_skills || '[]');
            const expertiseSkills = JSON.parse(char.expertise_skills || '[]');

            Object.entries(skills).forEach(([key, skill]) => {
                const abilityMod = Math.floor((characterStats[skill.ability] - 10) / 2);
                const isProficient = proficientSkills.includes(key);
                const hasExpertise = expertiseSkills.includes(key);

                let bonus = abilityMod;
                if (hasExpertise) {
                    bonus += profBonus * 2;
                } else if (isProficient) {
                    bonus += profBonus;
                }

                const bonusText = bonus >= 0 ? `+${bonus}` : `${bonus}`;

                const div = document.createElement('div');
                div.className = 'stat-compact' + (hasExpertise ? ' expertise' : (isProficient ? ' proficient' : ''));
                div.innerHTML = `
                    <span class="stat-name">
                        ${skill.name}
                        ${hasExpertise ? '<span class="expertise-badge">√ó2</span>' : ''}
                    </span>
                    <span class="stat-value">${bonusText}</span>
                `;
                skillsList.appendChild(div);
            });
        }

        async function loadFeatures(char) {
            try {
                const response = await fetch(`${API_URL}?action=class_features&class=rogue&level=${char.level}`);
                const result = await response.json();

                const featuresList = document.getElementById('featuresList');
                featuresList.innerHTML = '';

                if (result.success && result.data) {
                    result.data.forEach(feature => {
                        const div = document.createElement('div');
                        div.className = 'feature-item';
                        div.innerHTML = `
                            <h4>${feature.feature_name_de}</h4>
                            <p>${feature.description_de}</p>
                        `;
                        featuresList.appendChild(div);
                    });
                }
            } catch (error) {
                console.error('Fehler beim Laden der Features:', error);
            }
        }

        function loadEquipment(char) {
            const equipmentList = document.getElementById('equipmentList');
            equipmentList.innerHTML = '';

            const inventory = JSON.parse(char.inventory || '[]');
            const equipped = JSON.parse(char.equipped_items || '[]');

            if (inventory.length === 0) {
                equipmentList.innerHTML = '<p style="color: #ffd700; text-align: center;">Keine Ausr√ºstung</p>';
                return;
            }

            inventory.forEach(item => {
                const isEquipped = equipped.includes(item.id);
                const div = document.createElement('div');
                div.className = 'equipment-compact' + (isEquipped ? ' equipped' : '');
                div.innerHTML = `
                    <span class="equipment-name">${isEquipped ? '‚ö° ' : ''}${item.name}</span>
                    <span>${item.quantity || 1}√ó</span>
                `;
                equipmentList.appendChild(div);
            });
        }

        function loadWeapons(char) {
            const weaponsList = document.getElementById('weaponsList');
            weaponsList.innerHTML = '';

            const profBonus = getProficiencyBonus(char.level);
            const dexMod = Math.floor((char.dexterity - 10) / 2);
            const strMod = Math.floor((char.strength - 10) / 2);

            // Default pirate weapons
            const weapons = [
                { name: 'Rapier', attackMod: dexMod, damage: '1d8', damageType: 'Stich' },
                { name: 'Kurzbogen', attackMod: dexMod, damage: '1d6', damageType: 'Stich', range: '24/96m' },
                { name: 'Dolch', attackMod: dexMod, damage: '1d4', damageType: 'Stich', versatile: true }
            ];

            weapons.forEach(weapon => {
                const attackBonus = weapon.attackMod + profBonus;
                const attackText = attackBonus >= 0 ? `+${attackBonus}` : `${attackBonus}`;

                const div = document.createElement('div');
                div.className = 'weapon-attack';
                div.innerHTML = `
                    <div class="weapon-attack-header">
                        <span class="weapon-attack-name">‚öîÔ∏è ${weapon.name}</span>
                        <span class="weapon-attack-bonus">${attackText}</span>
                    </div>
                    <div class="weapon-attack-damage">
                        ${weapon.damage} ${weapon.damageType}${weapon.range ? ' ‚Ä¢ ' + weapon.range : ''}
                    </div>
                `;
                weaponsList.appendChild(div);
            });
        }

        function getProficiencyBonus(level) {
            return Math.ceil(level / 4) + 1;
        }

        function adjustHP(amount) {
            const current = parseInt(document.getElementById('currentHP').textContent);
            const max = parseInt(document.getElementById('maxHP').textContent);
            const newHP = Math.max(0, Math.min(max, current + amount));

            document.getElementById('currentHP').textContent = newHP;

            // Save to DB
            updateCharacterHP(newHP);
        }

        async function updateCharacterHP(newHP) {
            try {
                const formData = new FormData();
                formData.append('action', 'update_hp');
                formData.append('character_id', characterId);
                formData.append('current_hp', newHP);

                await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
            } catch (error) {
                console.error('Fehler beim Speichern der HP:', error);
            }
        }

        async function shortRest() {
            if (confirm('Kurze Rast nehmen? (1 Stunde)')) {
                try {
                    const response = await fetch(`${API_URL}?action=short_rest&character_id=${characterId}`);
                    const result = await response.json();

                    if (result.success) {
                        alert('Kurze Rast abgeschlossen! Du kannst Trefferw√ºrfel verwenden.');
                        loadCharacter();
                    }
                } catch (error) {
                    console.error('Fehler bei kurzer Rast:', error);
                }
            }
        }

        async function longRest() {
            if (confirm('Lange Rast nehmen? (8 Stunden) HP werden vollst√§ndig wiederhergestellt.')) {
                try {
                    const response = await fetch(`${API_URL}?action=long_rest&character_id=${characterId}`);
                    const result = await response.json();

                    if (result.success) {
                        alert('Lange Rast abgeschlossen! Alle Ressourcen wiederhergestellt.');
                        loadCharacter();
                    }
                } catch (error) {
                    console.error('Fehler bei langer Rast:', error);
                }
            }
        }

        function showEquipmentTab() {
            alert('Ausr√ºstungsverwaltung wird geladen...');
            // TODO: Navigate to equipment page
        }

        function showNotesTab() {
            alert('Notizfunktion wird geladen...');
            // TODO: Navigate to notes page
        }

        function showEquipmentBrowser() {
            alert('Ausr√ºstungs-Browser wird geladen...');
            // TODO: Open equipment browser modal
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadCharacter();
        });
    </script>
</body>
</html>
